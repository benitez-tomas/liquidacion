<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Welivery Liquidación Cleaner</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    padding: 20px;
}
textarea {
    width: 100%;
    height: 250px;
    margin-bottom: 15px;
    font-family: monospace;
}
button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
}
.container {
    max-width: 1200px;
    margin: auto;
}
h1 {
    margin-bottom: 5px;
}
small {
    color: gray;
}
</style>
</head>
<body>
<div class="container">
<h1>Liquidación Welivery Cleaner</h1>
<small>Pegá la tabla cruda del mail y convertí a formato limpio para Excel</small>

<h3>Entrada</h3>
<textarea id="input"></textarea>

<button onclick="procesar()">Procesar</button>

<h3>Salida (lista para pegar en Excel)</h3>
<textarea id="output"></textarea>
</div>

<script>
function limpiarNumero(valor) {
    if (!valor) return 0;

    valor = valor.replace(/\$/g, "")
                 .replace(/\./g, "")
                 .replace(/\s/g, "")
                 .replace(",", ".");

    if (valor === "") return 0;

    return Number(valor);
}

function formatearFecha(fecha) {
    let partes = fecha.split("/");
    if (partes.length !== 3) return fecha;

    let dia = partes[0].padStart(2, "0");
    let mes = partes[1].padStart(2, "0");
    let anio = partes[2];

    return `${dia}/${mes}/${anio}`;
}

function procesar() {
    let input = document.getElementById("input").value.trim();
    let filas = input.split("\n");

    if (filas.length === 0) return;

    let encabezados = filas[0].split("\t");

    // eliminar PROVEEDOR y columnas TARIFA
    let indicesValidos = [];

    encabezados.forEach((col, i) => {
        if (col === "PROVEEDOR") return;
        if (col.includes("TARIFA")) return;
        indicesValidos.push(i);
    });

    let resultado = [];

    filas.forEach((fila, filaIndex) => {
        let columnas = fila.split("\t");
        let nuevaFila = [];

        indicesValidos.forEach(i => {
            let valor = columnas[i] ?? "";

            // FECHA
            if (encabezados[i] === "FECHA" && filaIndex !== 0) {
                valor = formatearFecha(valor);
            }

            // EFECTIVIDAD
            if (encabezados[i] === "EFECTIVIDAD" && filaIndex !== 0) {
                valor = (Number(valor) / 100).toFixed(2);
            }

            // Números monetarios o cantidades
            if (filaIndex !== 0 && encabezados[i] !== "FECHA") {
                if (valor.includes("$") || valor.includes(".") || valor.includes("-")) {
                    valor = limpiarNumero(valor);
                }
            }

            nuevaFila.push(valor);
        });

        resultado.push(nuevaFila.join("\t"));
    });

    document.getElementById("output").value = resultado.join("\n");
}
</script>
</body>
</html>
